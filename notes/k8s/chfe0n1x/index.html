<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.17" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><link rel="icon" type="image/png" sizes="32x32" href="/blogger.png"><title>基于jenkins构建微服务发布平台 | 阿哲</title><meta name="description" content=""><link rel="preload" href="/assets/style-D1sUe2kL.css" as="style"><link rel="stylesheet" href="/assets/style-D1sUe2kL.css"><link rel="modulepreload" href="/assets/app-D5peQ_E2.js"><link rel="modulepreload" href="/assets/index.html-CWvZ-9Hu.js"><link rel="prefetch" href="/assets/index.html-BbydQqMH.js" as="script"><link rel="prefetch" href="/assets/index.html-Du37zU9u.js" as="script"><link rel="prefetch" href="/assets/index.html-CIshL6h3.js" as="script"><link rel="prefetch" href="/assets/index.html-BzNYU7RX.js" as="script"><link rel="prefetch" href="/assets/index.html-c02M_ZuU.js" as="script"><link rel="prefetch" href="/assets/index.html-CxcSUmtz.js" as="script"><link rel="prefetch" href="/assets/index.html-CXj0lBtF.js" as="script"><link rel="prefetch" href="/assets/index.html-BHVVIZY9.js" as="script"><link rel="prefetch" href="/assets/index.html-BaK4Wkpr.js" as="script"><link rel="prefetch" href="/assets/index.html-CHPUvHKi.js" as="script"><link rel="prefetch" href="/assets/index.html-DdhJTfwj.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz-NdHAP.js" as="script"><link rel="prefetch" href="/assets/index.html-DOl2RVYH.js" as="script"><link rel="prefetch" href="/assets/index.html-D99CTpob.js" as="script"><link rel="prefetch" href="/assets/index.html-CCcimEIG.js" as="script"><link rel="prefetch" href="/assets/index.html-B9P1_6ae.js" as="script"><link rel="prefetch" href="/assets/index.html-CI_I1LAf.js" as="script"><link rel="prefetch" href="/assets/index.html-CkmQmfYE.js" as="script"><link rel="prefetch" href="/assets/index.html-B3jgOQVh.js" as="script"><link rel="prefetch" href="/assets/index.html-bkwpV_6S.js" as="script"><link rel="prefetch" href="/assets/index.html-JrLheDFB.js" as="script"><link rel="prefetch" href="/assets/index.html-Dd_-pcwE.js" as="script"><link rel="prefetch" href="/assets/index.html-D8zqYDE9.js" as="script"><link rel="prefetch" href="/assets/index.html-CchHOCz_.js" as="script"><link rel="prefetch" href="/assets/index.html-DJ3OEPb6.js" as="script"><link rel="prefetch" href="/assets/index.html-BCCih5ek.js" as="script"><link rel="prefetch" href="/assets/index.html-B7Ei85F6.js" as="script"><link rel="prefetch" href="/assets/index.html-Duptj1R1.js" as="script"><link rel="prefetch" href="/assets/index.html-CiQSF3IV.js" as="script"><link rel="prefetch" href="/assets/index.html-XdH9DxSB.js" as="script"><link rel="prefetch" href="/assets/1.django知识回顾.html-Cmbv50hI.js" as="script"><link rel="prefetch" href="/assets/2.drf序列化器.html-Sx8Xl12Q.js" as="script"><link rel="prefetch" href="/assets/3.drf视图.html-D4itxuse.js" as="script"><link rel="prefetch" href="/assets/4.drf常用功能.html-3eKYXg_H.js" as="script"><link rel="prefetch" href="/assets/index.html-DNJfWryL.js" as="script"><link rel="prefetch" href="/assets/index.html-CNNdiOIg.js" as="script"><link rel="prefetch" href="/assets/index.html-CGWpM449.js" as="script"><link rel="prefetch" href="/assets/index.html-skwQ6DUx.js" as="script"><link rel="prefetch" href="/assets/index.html-BpL9ltJF.js" as="script"><link rel="prefetch" href="/assets/index.html-BDlu7whU.js" as="script"><link rel="prefetch" href="/assets/index.html-zOJqoRCx.js" as="script"><link rel="prefetch" href="/assets/index.html-Dc1hgEq2.js" as="script"><link rel="prefetch" href="/assets/index.html-C4jVssG7.js" as="script"><link rel="prefetch" href="/assets/index.html-BFwfoAaT.js" as="script"><link rel="prefetch" href="/assets/index.html-C3gkLPG9.js" as="script"><link rel="prefetch" href="/assets/index.html-DyffQVdb.js" as="script"><link rel="prefetch" href="/assets/index.html-CWLkAD-7.js" as="script"><link rel="prefetch" href="/assets/index.html-Copr927T.js" as="script"><link rel="prefetch" href="/assets/index.html-DeLXuJat.js" as="script"><link rel="prefetch" href="/assets/index.html-BK_BLglB.js" as="script"><link rel="prefetch" href="/assets/index.html-BYJlHLah.js" as="script"><link rel="prefetch" href="/assets/index.html-BYcRqGcJ.js" as="script"><link rel="prefetch" href="/assets/index.html-Cg4_Cvx_.js" as="script"><link rel="prefetch" href="/assets/index.html-XmL1IzTV.js" as="script"><link rel="prefetch" href="/assets/index.html--aEgTV2Z.js" as="script"><link rel="prefetch" href="/assets/index.html-DLQ3QgpG.js" as="script"><link rel="prefetch" href="/assets/index.html-LZYQU08o.js" as="script"><link rel="prefetch" href="/assets/index.html-Ll0fjA0A.js" as="script"><link rel="prefetch" href="/assets/index.html-BluD6MyY.js" as="script"><link rel="prefetch" href="/assets/index.html-KT0Ay9Fg.js" as="script"><link rel="prefetch" href="/assets/index.html-BVyem7_I.js" as="script"><link rel="prefetch" href="/assets/index.html-CKDIvefN.js" as="script"><link rel="prefetch" href="/assets/index.html-BWVK-mh2.js" as="script"><link rel="prefetch" href="/assets/index.html-tXzzm3eZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DtxCGkCZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ErAv7zoU.js" as="script"><link rel="prefetch" href="/assets/index.html-Hrx99ccO.js" as="script"><link rel="prefetch" href="/assets/index.html--VTHE8V7.js" as="script"><link rel="prefetch" href="/assets/index.html-BwNqpzY7.js" as="script"><link rel="prefetch" href="/assets/index.html-CkCOyff0.js" as="script"><link rel="prefetch" href="/assets/index.html-ONjnKC19.js" as="script"><link rel="prefetch" href="/assets/index.html-D5HMkDrP.js" as="script"><link rel="prefetch" href="/assets/index.html-D-MJsIH0.js" as="script"><link rel="prefetch" href="/assets/index.html-B7bLqN9Z.js" as="script"><link rel="prefetch" href="/assets/index.html-DYvXc_gQ.js" as="script"><link rel="prefetch" href="/assets/index.html-smkylglA.js" as="script"><link rel="prefetch" href="/assets/index.html-CFyCP7W3.js" as="script"><link rel="prefetch" href="/assets/index.html-DZRvpEl0.js" as="script"><link rel="prefetch" href="/assets/index.html-Bj3ve12S.js" as="script"><link rel="prefetch" href="/assets/index.html-B_7DS6xs.js" as="script"><link rel="prefetch" href="/assets/index.html-Cu-nAM8Y.js" as="script"><link rel="prefetch" href="/assets/index.html-BUqKWgOZ.js" as="script"><link rel="prefetch" href="/assets/index.html-D3so1Lcv.js" as="script"><link rel="prefetch" href="/assets/index.html-C9bTAdyQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CG0yRhjN.js" as="script"><link rel="prefetch" href="/assets/index.html-DVcB1Pj_.js" as="script"><link rel="prefetch" href="/assets/index.html-CBDqiSJg.js" as="script"><link rel="prefetch" href="/assets/index.html-B-JHXq8p.js" as="script"><link rel="prefetch" href="/assets/index.html-DqwAPSm7.js" as="script"><link rel="prefetch" href="/assets/404.html-CCfBXXFp.js" as="script"><link rel="prefetch" href="/assets/index.html-_TVdVrWF.js" as="script"><link rel="prefetch" href="/assets/index.html-DvTMMw6q.js" as="script"><link rel="prefetch" href="/assets/index.html-DyzjrEqU.js" as="script"><link rel="prefetch" href="/assets/index.html-zZTdMRCg.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/searchBox-default-BCF44HzZ.js" as="script"><link rel="prefetch" href="/assets/SearchBox-zoFp8PjU.js" as="script"><link rel="prefetch" href="/assets/giscus-C26m1eXs.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-BKYel-wA.js" as="script"></head><body><div id="app"><!--[--><div class="theme-plume vp-layout" vp-container data-v-0b7e05b4><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d5a8d0bc></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-d5a8d0bc> Skip to content </a><!--]--><!----><div class="vp-nav" data-v-0b7e05b4 data-v-1992b709><div class="vp-navbar" vp-navbar data-v-1992b709 data-v-70d97d16><div class="wrapper" data-v-70d97d16><div class="container" data-v-70d97d16><div class="title" data-v-70d97d16><div class="vp-navbar-title has-sidebar" data-v-70d97d16 data-v-2c8d4622><a class="vp-link no-icon link title" href="/" data-v-2c8d4622 data-v-442a52aa><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="/blogger.png" alt data-v-7fbfbc9b><!--]--><!--[--><img class="vp-image light logo" src="/blogger.png" alt data-v-7fbfbc9b><!--]--><!--]--><!--]--><span data-v-2c8d4622>阿哲</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-70d97d16><div class="content-body" data-v-70d97d16><!--[--><!--]--><div class="vp-navbar-search search" data-v-70d97d16><div class="search-wrapper" data-v-97535d1e><!----><div id="local-search" data-v-97535d1e><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-97535d1e><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-70d97d16 data-v-d43c1732><span id="main-nav-aria-label" class="visually-hidden" data-v-d43c1732>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="https://liuzhemax.github.io/" target="_blank" rel="noreferrer" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>博客</span><!--]--><span class="vpi-external-link icon" data-v-442a52aa></span></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-feafea4e><span class="text" data-v-feafea4e><!----><!----><span data-v-feafea4e>笔记</span><span class="vpi-chevron-down text-icon" data-v-feafea4e></span></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/notes/k8s/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> K8S入门到进阶<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/notes/python/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Python基础<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/notes/django/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Django入门到进阶<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/notes/web/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 前端基础<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-feafea4e><span class="text" data-v-feafea4e><!----><!----><span data-v-feafea4e>开源项目</span><span class="vpi-chevron-down text-icon" data-v-feafea4e></span></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/notes/devops/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 自动化运维平台<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-feafea4e><span class="text" data-v-feafea4e><!----><!----><span data-v-feafea4e>更多</span><span class="vpi-chevron-down text-icon" data-v-feafea4e></span></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/notes/more/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 站点导航<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/about/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>关于</span><!--]--><!----></a><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-70d97d16 data-v-a295abf6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a295abf6 data-v-537740e0 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-537740e0></span><span class="vpi-moon moon" data-v-537740e0></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-70d97d16 data-v-ad52545c data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/liuzhemax" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><a class="vp-social-link no-icon" href="https://gitee.com/lucky_liuzhe/" aria-label target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><svg t="1727923245710" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2305" width="200" height="200"><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z" fill="#C71D23" p-id="2306"></path></svg></a><a class="vp-social-link no-icon" href="/about/#联系我" aria-label target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><svg t="1727923648082" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8105" width="200" height="200"><path d="M337.387283 341.82659c-17.757225 0-35.514451 11.83815-35.514451 29.595375s17.757225 29.595376 35.514451 29.595376 29.595376-11.83815 29.595376-29.595376c0-18.49711-11.83815-29.595376-29.595376-29.595375zM577.849711 513.479769c-11.83815 0-22.936416 12.578035-22.936416 23.6763 0 12.578035 11.83815 23.676301 22.936416 23.676301 17.757225 0 29.595376-11.83815 29.595376-23.676301s-11.83815-23.676301-29.595376-23.6763zM501.641618 401.017341c17.757225 0 29.595376-12.578035 29.595376-29.595376 0-17.757225-11.83815-29.595376-29.595376-29.595375s-35.514451 11.83815-35.51445 29.595375 17.757225 29.595376 35.51445 29.595376zM706.589595 513.479769c-11.83815 0-22.936416 12.578035-22.936416 23.6763 0 12.578035 11.83815 23.676301 22.936416 23.676301 17.757225 0 29.595376-11.83815 29.595376-23.676301s-11.83815-23.676301-29.595376-23.6763z" fill="#28C445" p-id="8106"></path><path d="M510.520231 2.959538C228.624277 2.959538 0 231.583815 0 513.479769s228.624277 510.520231 510.520231 510.520231 510.520231-228.624277 510.520231-510.520231-228.624277-510.520231-510.520231-510.520231zM413.595376 644.439306c-29.595376 0-53.271676-5.919075-81.387284-12.578034l-81.387283 41.433526 22.936416-71.768786c-58.450867-41.433526-93.965318-95.445087-93.965317-159.815029 0-113.202312 105.803468-201.988439 233.803468-201.98844 114.682081 0 216.046243 71.028902 236.023121 166.473989-7.398844-0.739884-14.797688-1.479769-22.196532-1.479769-110.982659 1.479769-198.289017 85.086705-198.289017 188.67052 0 17.017341 2.959538 33.294798 7.398844 49.572255-7.398844 0.739884-15.537572 1.479769-22.936416 1.479768z m346.265896 82.867052l17.757225 59.190752-63.630058-35.514451c-22.936416 5.919075-46.612717 11.83815-70.289017 11.83815-111.722543 0-199.768786-76.947977-199.768786-172.393063-0.739884-94.705202 87.306358-171.653179 198.289017-171.65318 105.803468 0 199.028902 77.687861 199.028902 172.393064 0 53.271676-34.774566 100.624277-81.387283 136.138728z" fill="#28C445" p-id="8107"></path></svg></a><a class="vp-social-link no-icon" href="/about/#联系我" aria-label target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><svg t="1727921239345" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7478" width="200" height="200"><path d="M511.09761 957.257c-80.159 0-153.737-25.019-201.11-62.386-24.057 6.702-54.831 17.489-74.252 30.864-16.617 11.439-14.546 23.106-11.55 27.816 13.15 20.689 225.583 13.211 286.912 6.767v-3.061z" fill="#FAAD08" p-id="7479"></path><path d="M496.65061 957.257c80.157 0 153.737-25.019 201.11-62.386 24.057 6.702 54.83 17.489 74.253 30.864 16.616 11.439 14.543 23.106 11.55 27.816-13.15 20.689-225.584 13.211-286.914 6.767v-3.061z" fill="#FAAD08" p-id="7480"></path><path d="M497.12861 474.524c131.934-0.876 237.669-25.783 273.497-35.34 8.541-2.28 13.11-6.364 13.11-6.364 0.03-1.172 0.542-20.952 0.542-31.155C784.27761 229.833 701.12561 57.173 496.64061 57.162 292.15661 57.173 209.00061 229.832 209.00061 401.665c0 10.203 0.516 29.983 0.547 31.155 0 0 3.717 3.821 10.529 5.67 33.078 8.98 140.803 35.139 276.08 36.034h0.972z" fill="#000000" p-id="7481"></path><path d="M860.28261 619.782c-8.12-26.086-19.204-56.506-30.427-85.72 0 0-6.456-0.795-9.718 0.148-100.71 29.205-222.773 47.818-315.792 46.695h-0.962C410.88561 582.017 289.65061 563.617 189.27961 534.698 185.44461 533.595 177.87261 534.063 177.87261 534.063 166.64961 563.276 155.56661 593.696 147.44761 619.782 108.72961 744.168 121.27261 795.644 130.82461 796.798c20.496 2.474 79.78-93.637 79.78-93.637 0 97.66 88.324 247.617 290.576 248.996a718.01 718.01 0 0 1 5.367 0C708.80161 950.778 797.12261 800.822 797.12261 703.162c0 0 59.284 96.111 79.783 93.637 9.55-1.154 22.093-52.63-16.623-177.017" fill="#000000" p-id="7482"></path><path d="M434.38261 316.917c-27.9 1.24-51.745-30.106-53.24-69.956-1.518-39.877 19.858-73.207 47.764-74.454 27.875-1.224 51.703 30.109 53.218 69.974 1.527 39.877-19.853 73.2-47.742 74.436m206.67-69.956c-1.494 39.85-25.34 71.194-53.24 69.956-27.888-1.238-49.269-34.559-47.742-74.435 1.513-39.868 25.341-71.201 53.216-69.974 27.909 1.247 49.285 34.576 47.767 74.453" fill="#FFFFFF" p-id="7483"></path><path d="M683.94261 368.627c-7.323-17.609-81.062-37.227-172.353-37.227h-0.98c-91.29 0-165.031 19.618-172.352 37.227a6.244 6.244 0 0 0-0.535 2.505c0 1.269 0.393 2.414 1.006 3.386 6.168 9.765 88.054 58.018 171.882 58.018h0.98c83.827 0 165.71-48.25 171.881-58.016a6.352 6.352 0 0 0 1.002-3.395c0-0.897-0.2-1.736-0.531-2.498" fill="#FAAD08" p-id="7484"></path><path d="M467.63161 256.377c1.26 15.886-7.377 30-19.266 31.542-11.907 1.544-22.569-10.083-23.836-25.978-1.243-15.895 7.381-30.008 19.25-31.538 11.927-1.549 22.607 10.088 23.852 25.974m73.097 7.935c2.533-4.118 19.827-25.77 55.62-17.886 9.401 2.07 13.75 5.116 14.668 6.316 1.355 1.77 1.726 4.29 0.352 7.684-2.722 6.725-8.338 6.542-11.454 5.226-2.01-0.85-26.94-15.889-49.905 6.553-1.579 1.545-4.405 2.074-7.085 0.242-2.678-1.834-3.786-5.553-2.196-8.135" fill="#000000" p-id="7485"></path><path d="M504.33261 584.495h-0.967c-63.568 0.752-140.646-7.504-215.286-21.92-6.391 36.262-10.25 81.838-6.936 136.196 8.37 137.384 91.62 223.736 220.118 224.996H506.48461c128.498-1.26 211.748-87.612 220.12-224.996 3.314-54.362-0.547-99.938-6.94-136.203-74.654 14.423-151.745 22.684-215.332 21.927" fill="#FFFFFF" p-id="7486"></path><path d="M323.27461 577.016v137.468s64.957 12.705 130.031 3.91V591.59c-41.225-2.262-85.688-7.304-130.031-14.574" fill="#EB1C26" p-id="7487"></path><path d="M788.09761 432.536s-121.98 40.387-283.743 41.539h-0.962c-161.497-1.147-283.328-41.401-283.744-41.539l-40.854 106.952c102.186 32.31 228.837 53.135 324.598 51.926l0.96-0.002c95.768 1.216 222.4-19.61 324.6-51.924l-40.855-106.952z" fill="#EB1C26" p-id="7488"></path></svg></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-70d97d16 data-v-652282fd data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-feafea4e><span class="vpi-more-horizontal icon" data-v-feafea4e></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><!----><!--[--><!--[--><!----><div class="group" data-v-652282fd><div class="item appearance" data-v-652282fd><p class="label" data-v-652282fd>外观</p><div class="appearance-action" data-v-652282fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-652282fd data-v-537740e0 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-537740e0></span><span class="vpi-moon moon" data-v-537740e0></span><!--]--></span></span></button></div></div></div><div class="group" data-v-652282fd><div class="item social-links" data-v-652282fd><div class="vp-social-links social-links-list" data-v-652282fd data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/liuzhemax" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><a class="vp-social-link no-icon" href="https://gitee.com/lucky_liuzhe/" aria-label target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><svg t="1727923245710" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2305" width="200" height="200"><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z" fill="#C71D23" p-id="2306"></path></svg></a><a class="vp-social-link no-icon" href="/about/#联系我" aria-label target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><svg t="1727923648082" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8105" width="200" height="200"><path d="M337.387283 341.82659c-17.757225 0-35.514451 11.83815-35.514451 29.595375s17.757225 29.595376 35.514451 29.595376 29.595376-11.83815 29.595376-29.595376c0-18.49711-11.83815-29.595376-29.595376-29.595375zM577.849711 513.479769c-11.83815 0-22.936416 12.578035-22.936416 23.6763 0 12.578035 11.83815 23.676301 22.936416 23.676301 17.757225 0 29.595376-11.83815 29.595376-23.676301s-11.83815-23.676301-29.595376-23.6763zM501.641618 401.017341c17.757225 0 29.595376-12.578035 29.595376-29.595376 0-17.757225-11.83815-29.595376-29.595376-29.595375s-35.514451 11.83815-35.51445 29.595375 17.757225 29.595376 35.51445 29.595376zM706.589595 513.479769c-11.83815 0-22.936416 12.578035-22.936416 23.6763 0 12.578035 11.83815 23.676301 22.936416 23.676301 17.757225 0 29.595376-11.83815 29.595376-23.676301s-11.83815-23.676301-29.595376-23.6763z" fill="#28C445" p-id="8106"></path><path d="M510.520231 2.959538C228.624277 2.959538 0 231.583815 0 513.479769s228.624277 510.520231 510.520231 510.520231 510.520231-228.624277 510.520231-510.520231-228.624277-510.520231-510.520231-510.520231zM413.595376 644.439306c-29.595376 0-53.271676-5.919075-81.387284-12.578034l-81.387283 41.433526 22.936416-71.768786c-58.450867-41.433526-93.965318-95.445087-93.965317-159.815029 0-113.202312 105.803468-201.988439 233.803468-201.98844 114.682081 0 216.046243 71.028902 236.023121 166.473989-7.398844-0.739884-14.797688-1.479769-22.196532-1.479769-110.982659 1.479769-198.289017 85.086705-198.289017 188.67052 0 17.017341 2.959538 33.294798 7.398844 49.572255-7.398844 0.739884-15.537572 1.479769-22.936416 1.479768z m346.265896 82.867052l17.757225 59.190752-63.630058-35.514451c-22.936416 5.919075-46.612717 11.83815-70.289017 11.83815-111.722543 0-199.768786-76.947977-199.768786-172.393063-0.739884-94.705202 87.306358-171.653179 198.289017-171.65318 105.803468 0 199.028902 77.687861 199.028902 172.393064 0 53.271676-34.774566 100.624277-81.387283 136.138728z" fill="#28C445" p-id="8107"></path></svg></a><a class="vp-social-link no-icon" href="/about/#联系我" aria-label target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><svg t="1727921239345" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7478" width="200" height="200"><path d="M511.09761 957.257c-80.159 0-153.737-25.019-201.11-62.386-24.057 6.702-54.831 17.489-74.252 30.864-16.617 11.439-14.546 23.106-11.55 27.816 13.15 20.689 225.583 13.211 286.912 6.767v-3.061z" fill="#FAAD08" p-id="7479"></path><path d="M496.65061 957.257c80.157 0 153.737-25.019 201.11-62.386 24.057 6.702 54.83 17.489 74.253 30.864 16.616 11.439 14.543 23.106 11.55 27.816-13.15 20.689-225.584 13.211-286.914 6.767v-3.061z" fill="#FAAD08" p-id="7480"></path><path d="M497.12861 474.524c131.934-0.876 237.669-25.783 273.497-35.34 8.541-2.28 13.11-6.364 13.11-6.364 0.03-1.172 0.542-20.952 0.542-31.155C784.27761 229.833 701.12561 57.173 496.64061 57.162 292.15661 57.173 209.00061 229.832 209.00061 401.665c0 10.203 0.516 29.983 0.547 31.155 0 0 3.717 3.821 10.529 5.67 33.078 8.98 140.803 35.139 276.08 36.034h0.972z" fill="#000000" p-id="7481"></path><path d="M860.28261 619.782c-8.12-26.086-19.204-56.506-30.427-85.72 0 0-6.456-0.795-9.718 0.148-100.71 29.205-222.773 47.818-315.792 46.695h-0.962C410.88561 582.017 289.65061 563.617 189.27961 534.698 185.44461 533.595 177.87261 534.063 177.87261 534.063 166.64961 563.276 155.56661 593.696 147.44761 619.782 108.72961 744.168 121.27261 795.644 130.82461 796.798c20.496 2.474 79.78-93.637 79.78-93.637 0 97.66 88.324 247.617 290.576 248.996a718.01 718.01 0 0 1 5.367 0C708.80161 950.778 797.12261 800.822 797.12261 703.162c0 0 59.284 96.111 79.783 93.637 9.55-1.154 22.093-52.63-16.623-177.017" fill="#000000" p-id="7482"></path><path d="M434.38261 316.917c-27.9 1.24-51.745-30.106-53.24-69.956-1.518-39.877 19.858-73.207 47.764-74.454 27.875-1.224 51.703 30.109 53.218 69.974 1.527 39.877-19.853 73.2-47.742 74.436m206.67-69.956c-1.494 39.85-25.34 71.194-53.24 69.956-27.888-1.238-49.269-34.559-47.742-74.435 1.513-39.868 25.341-71.201 53.216-69.974 27.909 1.247 49.285 34.576 47.767 74.453" fill="#FFFFFF" p-id="7483"></path><path d="M683.94261 368.627c-7.323-17.609-81.062-37.227-172.353-37.227h-0.98c-91.29 0-165.031 19.618-172.352 37.227a6.244 6.244 0 0 0-0.535 2.505c0 1.269 0.393 2.414 1.006 3.386 6.168 9.765 88.054 58.018 171.882 58.018h0.98c83.827 0 165.71-48.25 171.881-58.016a6.352 6.352 0 0 0 1.002-3.395c0-0.897-0.2-1.736-0.531-2.498" fill="#FAAD08" p-id="7484"></path><path d="M467.63161 256.377c1.26 15.886-7.377 30-19.266 31.542-11.907 1.544-22.569-10.083-23.836-25.978-1.243-15.895 7.381-30.008 19.25-31.538 11.927-1.549 22.607 10.088 23.852 25.974m73.097 7.935c2.533-4.118 19.827-25.77 55.62-17.886 9.401 2.07 13.75 5.116 14.668 6.316 1.355 1.77 1.726 4.29 0.352 7.684-2.722 6.725-8.338 6.542-11.454 5.226-2.01-0.85-26.94-15.889-49.905 6.553-1.579 1.545-4.405 2.074-7.085 0.242-2.678-1.834-3.786-5.553-2.196-8.135" fill="#000000" p-id="7485"></path><path d="M504.33261 584.495h-0.967c-63.568 0.752-140.646-7.504-215.286-21.92-6.391 36.262-10.25 81.838-6.936 136.196 8.37 137.384 91.62 223.736 220.118 224.996H506.48461c128.498-1.26 211.748-87.612 220.12-224.996 3.314-54.362-0.547-99.938-6.94-136.203-74.654 14.423-151.745 22.684-215.332 21.927" fill="#FFFFFF" p-id="7486"></path><path d="M323.27461 577.016v137.468s64.957 12.705 130.031 3.91V591.59c-41.225-2.262-85.688-7.304-130.031-14.574" fill="#EB1C26" p-id="7487"></path><path d="M788.09761 432.536s-121.98 40.387-283.743 41.539h-0.962c-161.497-1.147-283.328-41.401-283.744-41.539l-40.854 106.952c102.186 32.31 228.837 53.135 324.598 51.926l0.96-0.002c95.768 1.216 222.4-19.61 324.6-51.924l-40.855-106.952z" fill="#EB1C26" p-id="7488"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-70d97d16 data-v-2b50024d><span class="container" data-v-2b50024d><span class="top" data-v-2b50024d></span><span class="middle" data-v-2b50024d></span><span class="bottom" data-v-2b50024d></span></span></button></div></div></div></div><div class="divider" data-v-70d97d16><div class="divider-line" data-v-70d97d16></div></div></div><!----></div><div class="vp-local-nav reached-top is-blog" data-v-0b7e05b4 data-v-1dc3518c><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-1dc3518c><span class="vpi-align-left menu-icon" data-v-1dc3518c></span><span class="menu-text" data-v-1dc3518c>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-1dc3518c data-v-423a73ec><button data-v-423a73ec>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-0b7e05b4 data-v-360082b7><div class="curtain" data-v-360082b7></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-360082b7><span id="sidebar-aria-label" class="visually-hidden" data-v-360082b7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0" data-v-473fd05b data-v-b88148be><!----><div class="items" data-v-b88148be><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>K8S学习笔记</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-473fd05b data-v-b88148be><div class="item" role="button" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><h2 class="text" data-v-b88148be>K8S入门</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b88148be><span class="vpi-chevron-right caret-icon" data-v-b88148be></span></div></div><div class="items" data-v-b88148be><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/wcm7h7pv/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>kubernetes核心概念</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/jdqmd1pv/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>快速部署一个k8s集群</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/uf1ihb99/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>kubectl命令行管理工具</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/zhfb2l1h/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>资源编排</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/eyoeje2f/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>深入理解pod对象调度</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/tmkuv016/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>深入理解pod对象基本管理</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/cu141vso/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>常用工作负载控制器</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/m32l4596/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>service对外暴露你的应用</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/ly9z7gd3/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>ingress最佳方式对外暴露应用</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/6aa06sf3/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>管理应用程序配置</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/mg20s2pp/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>数据卷与持久数据卷</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/2rouji53/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>再谈有状态应用部署statefulset</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/i3m5hqy8/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>k8s安全控制</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/qexangap/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>k8s应用包管理器helm初探</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/vbm16uxm/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>实际项目部署案例</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/dxxfsk66/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>prometheus监控kubernetes</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/csp1s14g/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>elk收集kubernetes应用日志</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/bmmioclu/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>基于jenkins构建持续集成ci平台</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible has-active" data-v-473fd05b data-v-b88148be><div class="item" role="button" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><h2 class="text" data-v-b88148be>K8S进阶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b88148be><span class="vpi-chevron-right caret-icon" data-v-b88148be></span></div></div><div class="items" data-v-b88148be><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/dpeuv5bm/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>kubernetes运维管理</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/bhw3hbjh/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>kubernetes弹性伸缩</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/lbvvqgtj/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>kubernetes应用包管理器helm上</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/lo8jgp54/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>kubernetes应用包管理器helm下</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/e7q1cuv0/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>k8s集群网络上</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/e3olzjeh/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>k8s集群网络下</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/0orp8ikp/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>微服务容器化迁移</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/chfe0n1x/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>基于jenkins构建微服务发布平台</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/hed98b6p/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>微服务治理istio初探上</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" tabindex="0" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/notes/k8s/8h4h0qk9/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>微服务治理istio初探下</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-0b7e05b4 data-v-eb709286><div class="has-sidebar has-aside vp-doc-container" data-v-e798167f><!--[--><!--]--><div class="container" data-v-e798167f><div class="aside" vp-outline data-v-e798167f><div class="aside-curtain" data-v-e798167f></div><div class="aside-container" data-v-e798167f><div class="aside-content" data-v-e798167f><div class="vp-doc-aside" data-v-e798167f data-v-5976474c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-5976474c data-v-aa56eba0><div class="content" data-v-aa56eba0><div class="outline-marker" data-v-aa56eba0></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-aa56eba0><span data-v-aa56eba0>此页内容</span><span class="vpi-print icon" data-v-aa56eba0></span></div><ul class="root" data-v-aa56eba0 data-v-54c74388><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-5976474c></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-e798167f><div class="content-container" data-v-e798167f><!--[--><!--]--><main class="main" data-v-e798167f><nav class="vp-breadcrumb" data-v-e798167f data-v-0668b171><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-0668b171><!--[--><li property="itemListElement" typeof="ListItem" data-v-0668b171><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-0668b171 data-v-442a52aa><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-0668b171></span><meta property="position" content="1" data-v-0668b171></li><li property="itemListElement" typeof="ListItem" data-v-0668b171><span class="vp-link no-icon breadcrumb" href="/" property="item" typeof="WebPage" data-v-0668b171 data-v-442a52aa><!--[-->K8S进阶<!--]--><!----></span><span class="vpi-chevron-right" data-v-0668b171></span><meta property="position" content="2" data-v-0668b171></li><li property="itemListElement" typeof="ListItem" data-v-0668b171><a class="vp-link no-icon link breadcrumb current" href="/notes/k8s/chfe0n1x/" property="item" typeof="WebPage" data-v-0668b171 data-v-442a52aa><!--[-->基于jenkins构建微服务发布平台<!--]--><!----></a><!----><meta property="position" content="3" data-v-0668b171></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-01a979e8>基于jenkins构建微服务发布平台 <!----></h1><div class="vp-doc-meta" data-v-01a979e8><p class="reading-time" data-v-01a979e8><span class="vpi-books icon" data-v-01a979e8></span><span data-v-01a979e8>2700字</span><span data-v-01a979e8>约9分钟</span></p><!----><p class="create-time" data-v-01a979e8><span class="vpi-clock icon" data-v-01a979e8></span><span data-v-01a979e8>2024-09-29</span></p></div><!--]--><div class="vp-doc plume-content _notes_k8s_chfe0n1x_ external-link-icon-enabled" vp-content data-v-e798167f><h2 id="发布流程设计" tabindex="-1"><a class="header-anchor" href="#发布流程设计"><span>发布流程设计</span></a></h2><p><img src="/images/B2F7E8D287EA48A3925A323A7330F159clipboard.png" alt=""></p><h2 id="准备基础环境-harbor、gitlab、jenkins" tabindex="-1"><a class="header-anchor" href="#准备基础环境-harbor、gitlab、jenkins"><span>准备基础环境：Harbor、Gitlab、Jenkins</span></a></h2><h3 id="harbor镜像仓库" tabindex="-1"><a class="header-anchor" href="#harbor镜像仓库"><span>Harbor镜像仓库</span></a></h3><p>项目地址：https://github.com/goharbor/harbor</p><p>1.安装docker与docker-compose</p><p>2.解压离线包部署</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># tar zxvf harbor-offline-installer-v2.0.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># cd harbor</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># cp harbor.yml.tmpl harbor.yml</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># vi harbor.yml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">hostname:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 192.168.0.14</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">https:</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 先注释https相关配置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">harbor_admin_password:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Harbor12345</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># ./prepare</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># ./install.sh --with-chartmuseum</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># docker-compose ps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在Jenkins主机配置Docker可信任，如果是HTTPS需要拷贝证书</li></ol><p>由于habor未配置https，还需要在docker配置可信任。</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># cat /etc/docker/daemon.json </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;registry-mirrors&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">https://b9pmyelo.mirror.aliyuncs.com</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">],</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  &quot;insecure-registries&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.0.12</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># systemctl restart docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gitlab代码仓库" tabindex="-1"><a class="header-anchor" href="#gitlab代码仓库"><span>Gitlab代码仓库</span></a></h3><p>在Gitlab创建一个项目，然后提交微服务项目代码。</p><p>如果没有Gitlab可以使用Docker启动一个：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /opt/gitlab</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">GITLAB_HOME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/opt/gitlab</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 数据持久化目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --detach</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--publish </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">443:443</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--publish </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">88:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--publish </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">2222:22</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--name </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gitlab</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--restart </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">always</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--volume </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$GITLAB_HOME</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/config:/etc/gitlab</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--volume </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$GITLAB_HOME</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/logs:/var/log/gitlab</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--volume </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$GITLAB_HOME</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/data:/var/opt/gitlab</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">gitlab/gitlab-ce:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问地址：http://IP:88</p><p>初次会先设置管理员密码 ，然后登陆，默认管理员用户名 root，密码就是刚设置的。</p><p><img src="/images/8A7782825408485B8DA8EE01B54B7C6Fclipboard.png" alt=""></p><h3 id="jenkins-发布系统" tabindex="-1"><a class="header-anchor" href="#jenkins-发布系统"><span>Jenkins 发布系统</span></a></h3><p><img src="/images/8500E07205C24CC18CCB45F93929FA11clipboard.png" alt=""></p><p>Jenkins是一款开源 CI&amp;CD 系统，用于自动化各种任务，包括构建、测试和部署。</p><p>Jenkins官方提供了镜像：https://hub.docker.com/r/jenkins/jenkins</p><p>使用Deployment来部署这个镜像，会暴露两个端口：8080 Web访问端口，50000 Slave通 信端口，容器启动后Jenkins数据存储在/var/jenkins_home目录，所以需要将该目录使用 PV持久化存储。</p><p>配置PV持久化存储：</p><p>1、部署NFS共享服务器</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#安装nfs安装包（每个k8s节点都要安装）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs-utils</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>2、找一个节点作为NFS共享存储服务器</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#创建nfs共享目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /ifs/kubernetes/jenkins-data</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#修改nfs配置文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/exports</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">/ifs/kubernetes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.0/24</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">rw,no_root_squash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#启动nfs并加入开机自启</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#在别的节点验证是否能挂载成功</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.13:/ifs/kubernetes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3、为Jenkins准备PV</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#vi pv.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PersistentVolume</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pv0001</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  capacity:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    storage:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 5Gi</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  accessModes:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ReadWriteOnce</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  nfs:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /ifs/kubernetes/jenkins-data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    server:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 192.168.0.13</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#kubectl apply -f pv.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在k8s中部署jenkins</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jenkins.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>先安装后面所需的插件：</p><p>Jenkins下载插件默认服务器在国外，会比较慢，建议修改国内源：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 进入到nfs共享目录</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /ifs/kubernetes/jenkins-data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s/https:\/\/updates.jenkins.io\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default.json</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s/http:\/\/www.google.com/https:\/\/www.baidu.com/g</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 删除pod重建，pod名称改成你实际的</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jenkins-d58f4db66-9cthj</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ops</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>管理Jenkins-&gt;系统配置--&gt;管理插件--&gt;分别搜索Git Parameter/Git/Pipeline/kubernetes/Config File Provider， 选中点击安装。</p><ul><li><p>Git：拉取代码</p></li><li><p>Git Parameter：Git参数化构建</p></li><li><p>Pipeline：流水线</p></li><li><p>kubernetes：连接Kubernetes动态创建Slave代理</p></li><li><p>Config File Provider：存储配置文件</p></li><li><p>Extended Choice Parameter：扩展选择框参数，支持多选</p></li></ul><h2 id="jenkins在k8s中动态创建代理" tabindex="-1"><a class="header-anchor" href="#jenkins在k8s中动态创建代理"><span>Jenkins在K8s中动态创建代理</span></a></h2><h3 id="jenkins主从架构介绍" tabindex="-1"><a class="header-anchor" href="#jenkins主从架构介绍"><span>Jenkins主从架构介绍</span></a></h3><p><img src="/images/7F27157BF99A4F6B8BF5BCDE5C165B64clipboard.png" alt=""></p><p>Jenkins Master/Slave架构，Master（Jenkins本身）提供Web页面 让用户来管理项目和从节点（Slave），项目任务可以运行在Master 本机或者分配到从节点运行，一个Master可以关联多个Slave，这样 好处是可以让Slave分担Master工作压力和隔离构建环境。</p><p><img src="/images/EB9F74AB19714BC68A48BF040F27BAFAclipboard.png" alt=""></p><p>当触发Jenkins任务时，Jenkins会调用Kubernetes API 创建Slave Pod，Pod启动后会连接Jenkins，接受任务 并处理。</p><h3 id="kubernetes插件配置" tabindex="-1"><a class="header-anchor" href="#kubernetes插件配置"><span>Kubernetes插件配置</span></a></h3><p>Kubernetes插件：用于Jenkins在Kubernetes集群中运行动态代理</p><p>插件介绍：https://github.com/jenkinsci/kubernetes-plugin</p><p>配置插件：管理Jenkins-&gt;管理Nodes和云-&gt;管理云-&gt;添加Kubernetes</p><p><img src="/images/64DF0CDB13A542678BB863158428C832clipboard.png" alt=""></p><h3 id="自定义jenkins-slave镜像" tabindex="-1"><a class="header-anchor" href="#自定义jenkins-slave镜像"><span>自定义Jenkins Slave镜像</span></a></h3><p><img src="/images/2306CE36027E44559E61F897D61DC8C4clipboard.png" alt=""></p><p><a href="/attachments/2F46856C2A2540D8A87DCF2C081ADF24jenkins-slave.zip">jenkins-slave.zip</a></p><p>构建salve镜像</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">unzip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jenkins-slave.zip</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jenkins-slave/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>课件目录里涉及六个文件：</p><ul><li><p>Dockerfile：构建镜像</p></li><li><p>jenkins-slave：shell脚本启动slave.jar，下载地址：https://github.com/jenkinsci/docker-jnlpslave/blob/master/jenkins-slave</p></li><li><p>settings.xml：修改maven官方源为阿里云源</p></li><li><p>slave.jar：agent程序，接受master下发的任务，下载地址:http://jenkinsip:port/jnlpJars/slave.jar</p></li><li><p>helm和kubectl客户端工具</p></li></ul><p>构建并推送到镜像仓库：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.14/library/jenkins-slave-jdk:1.8</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> push</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.14/library/jenkins-slave-jdk:1.8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/images/4F2E0C1FDB52491EB084D555FB5714DCclipboard.png" alt=""></p><h3 id="测试主从架构是否正常" tabindex="-1"><a class="header-anchor" href="#测试主从架构是否正常"><span>测试主从架构是否正常</span></a></h3><p>新建项目-&gt;流水线-&gt;Pipeline脚本（可生成示例）</p><p><img src="/images/3164AADF3CAF40CFA508FCC5C9C1495Aclipboard.png" alt=""></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pipeline</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    agent</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        kubernetes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            label</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jenkins-slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            yaml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apiVersion: v1</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">kind: Pod</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  name: jenkins-slave</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">spec:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  containers:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  - name: jnlp</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    image: &quot;192.168.0.14/library/jenkins-slave-jdk:1.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    stages</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        stage(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&#39;Main&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            steps</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hostname</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="jenkins-pipeline流水线" tabindex="-1"><a class="header-anchor" href="#jenkins-pipeline流水线"><span>Jenkins Pipeline流水线</span></a></h2><h3 id="jenkins-pipeline-介绍" tabindex="-1"><a class="header-anchor" href="#jenkins-pipeline-介绍"><span>Jenkins Pipeline 介绍</span></a></h3><p>Jenkins Pipeline是一套运行工作流框架，将原本独立运行单个或者多个节点的任 务链接起来，实现单个任务难以完成的复杂流程编排和可视化。</p><ul><li><p>Jenkins Pipeline是一套插件，支持在Jenkins中实现持续集成和持续交付；</p></li><li><p>Pipeline通过特定语法对简单到复杂的传输管道进行建模；</p></li><li><p>Jenkins Pipeline的定义被写入一个文本文件，称为Jenkinsfile。</p></li></ul><p><img src="/images/7A0E7C80DA0F49268AE4F87D00FE7796clipboard.png" alt=""></p><h3 id="jenkins-pipeline-语法" tabindex="-1"><a class="header-anchor" href="#jenkins-pipeline-语法"><span>Jenkins Pipeline 语法</span></a></h3><p><img src="/images/6922CBDC75314869BF4EC5D6B8B586CCclipboard.png" alt=""></p><h3 id="jenkins-pipeline-示例" tabindex="-1"><a class="header-anchor" href="#jenkins-pipeline-示例"><span>Jenkins Pipeline 示例</span></a></h3><ul><li><p>Stages 是 Pipeline 中最主要的组成部分，Jenkins 将会按照 Stages 中描述的顺序 从上往下的执行。</p></li><li><p>Stage：阶段，一个 Pipeline 可以划分为若干个 Stage，每个 Stage 代表一组操作， 比如：Build、Test、Deploy</p></li><li><p>Steps：步骤，Steps 是最基本的操作单元，可以是打印一句话，也可以是构建一 个 Docker 镜像，由各类 Jenkins 插件提供，比如命令：sh ‘mvn&#39;，就相当于我 们平时 shell 终端中执行 mvn命令一样。</p></li></ul><p><img src="/images/D039E5F0FBA7457D81054CA87A761043clipboard.png" alt=""></p><h2 id="流水线自动发布微服务项目" tabindex="-1"><a class="header-anchor" href="#流水线自动发布微服务项目"><span>流水线自动发布微服务项目</span></a></h2><h3 id="发布需求" tabindex="-1"><a class="header-anchor" href="#发布需求"><span>发布需求</span></a></h3><p>在将微服务项目自动化部署到K8s平台会有这些需求：</p><ul><li><p>尽量完全自动化部署，无需过多人工干预</p></li><li><p>可以选择升级某个、某些微服务</p></li><li><p>在部署、升级微服务时，可对微服务某些特性做配置，例如命名 空间、副本数量</p></li></ul><p><img src="/images/C157478FA8444B3C8BC50AB432519AC3clipboard.png" alt=""></p><p><img src="/images/F8769BAA03AA41BCAF7F8A7FBE101D13clipboard.png" alt=""></p><h3 id="实现思路" tabindex="-1"><a class="header-anchor" href="#实现思路"><span>实现思路</span></a></h3><p>Pipeline编写思路：</p><p>在微服务架构中，会涉及几个、几十个微服务，如果每个服务都创建一个item，势必 给运维维护成本增加很大，因此需要编写一个通用Pipeline脚本，将这些微服务部署 差异化部分使用Jenkins参数化，人工交互确认发布的微服务、环境配置等。 但这只是解决用户交互层面，在K8s实际部署项目用YAML创建对应资源，现在问题是 如何接收用户交互参数，自动化生成YAML文件，这就会用到Helm完成YAML文件高 效复用和微服务部署。</p><p>部署一个微服务项目，每个微服务的差异化部分在哪里？</p><ul><li><p>服务名称</p></li><li><p>代码版本</p></li><li><p>镜像</p></li><li><p>端口</p></li><li><p>副本数</p></li><li><p>标签</p></li><li><p>域名</p></li></ul><p><img src="/images/41CB808D432741CEADC62C7EC31B02CFclipboard.png" alt=""></p><p><img src="/images/5725CE9936DC44278AB0F3D50A9C0043clipboard.png" alt=""></p><h3 id="编写pipeline流水线脚本" tabindex="-1"><a class="header-anchor" href="#编写pipeline流水线脚本"><span>编写Pipeline流水线脚本</span></a></h3><p>对于课件中的Pipeline脚本，重点修改这几个变量：</p><p><img src="/images/BBB9C34FC8074B8B8F2A8593A0D069D9clipboard.png" alt=""></p><p>1、将harbor认证和gitlab认证保存到Jenkins凭据</p><p>管理Jenkins-&gt;安全--&gt;管理凭据-&gt;Jnekins-&gt;添加凭据-&gt;Username with password</p><p>分别添加连接gitlab和harbor的用户名到Jenkins凭据，然后获取该凭据ID替换到脚本中docker_registry_auth和git_auth变量的值。</p><p><img src="/images/1038F7245A06447F8D9087E37A05849Bclipboard.png" alt=""></p><p>2、将kubeconfig存储在Jenkins，用于slave镜像里kubectl连接k8s集群</p><p>管理Jenkins-&gt; Managed files-&gt;Add-&gt;Custom file -&gt;Content字段内容是kubeconfig（kubeadm部署k8s默认路径在master节点 /root/.kube/config，如果你是二进制部署，需要自己生成，参考下面），然后复制ID替换上述脚本中k8s_auth变量的值。</p><p>说明：将kubectl、helm工具封装到Slave镜像中，并通过Config File Provider插件存储连接K8s集群的kubeconfig认证文件，然后挂载到 Slave容器中，这样就能用kubectl apply deploy.yaml --kubeconfig=config管理K8s应用了，为提高安全性，kubeconfig文件可分配权限。</p><p><img src="/images/8E0858A3DE2A4C5B8F819C098461D101clipboard.png" alt=""></p><p>3.上传 helm chart包到镜像仓库</p><p><a href="/attachments/0D60374F19514E8F9EE6A7B512555D72ms-0.1.0.tgz">ms-0.1.0.tgz</a></p><p><img src="/images/22F701F84D6D4280B76FE0E49F0002F6clipboard.png" alt=""></p><p>创建命名空间并部署eureka和MySQL服务（记得还要部署ingress控制器）</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> namespace</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ms</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql.yaml</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#启动部署(修改eureka-service微服务yaml文件中的requests，请求资源设置小一点0.2)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./docker_build.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eureka-service</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ingress-controller.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jenkinsfile</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/usr/bin/env groovy</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">//</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 所需插件:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Parameter/Git/Pipeline/Config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> File</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Provider/kubernetes/Extended</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Choice</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Parameter</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">//</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 公共</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> registry</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.0.14</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">//</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 项目</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> operation</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">microservice</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git_url</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">http://192.168.0.14:88/root/k8s-microservice.git</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gateway_domain_name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gateway.ctnrs.com</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> portal_domain_name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">portal.ctnrs.com</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">//</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 认证</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image_pull_secret</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry-pull-secret</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> harbor_auth</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dc8877f5-3238-407f-a9fb-96932501a9b0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git_auth</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">8d022667-0d69-4e5c-a6f8-6d0ac532f596</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">//</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ConfigFileProvider</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ID</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> k8s_auth</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">cf3c93bc-dc97-4305-8379-53a669a2b2b7</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pipeline</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  agent</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    kubernetes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        label</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jenkins-slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        yaml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apiVersion: v1</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">kind: Pod</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  name: jenkins-slave</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">spec:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  containers:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  - name: jnlp</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    image: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">registry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/library/jenkins-slave-jdk:1.8</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    imagePullPolicy: Always</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      - name: docker-cmd</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        mountPath: /usr/bin/docker</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      - name: docker-sock</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        mountPath: /var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      - name: maven-cache</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        mountPath: /root/.m2</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  volumes:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    - name: docker-cmd</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      hostPath:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        path: /usr/bin/docker</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    - name: docker-sock</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      hostPath:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        path: /var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    - name: maven-cache</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      hostPath:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        path: /tmp/m2</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    parameters</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        gitParameter</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> branch:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> branchFilter:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.*</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> defaultValue:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">origin/master</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> description:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">选择发布的分支</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Branch</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> quickFilterEnabled:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> selectedValue:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">NONE</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sortMode:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">NONE</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tagFilter:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">*</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> type:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">PT_BRANCH</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        extendedChoice</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> defaultValue:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">none</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> description:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">选择发布的微服务</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          multiSelectDelimiter:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> type:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">PT_CHECKBOX</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          value:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gateway-service:9999,portal-service:8080,product-service:8010,order-service:8020,stock-service:8030</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        choice</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (choices: [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ms</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">demo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">],</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> description:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">部署模板</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Template</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        choice</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (choices: [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">3</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">5</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">7</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">],</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> description:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">副本数</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ReplicaCount</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        choice</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (choices: [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ms</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">], description: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">命名空间</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, name: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Namespace</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    stages</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        stage(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&#39;拉取代码&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">){</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            steps</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                checkout([$class:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">GitSCM</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                branches:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [[name: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">params.Branch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">]],</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                extensions:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [], </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                userRemoteConfigs:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [[credentialsId: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">git_auth</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> url:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">git_url</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                ])</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        stage(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&#39;代码编译&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            //</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 编译指定服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            steps</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  mvn clean package -Dmaven.test.skip=true</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        stage(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&#39;构建镜像&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          steps</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              withCredentials([usernamePassword(credentialsId:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">harbor_auth</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> passwordVariable:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">password</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> usernameVariable:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">username</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)]) </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                 docker login -u </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">username</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -p &#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">password</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&#39; </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                 for service in </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">(echo </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> |sed &#39;s/,/ /g&#39;); do</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    service_name=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service%:*}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    image_name=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">operation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name}:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">BUILD_NUMBER</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    cd </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    if ls |grep biz &amp;&gt;/dev/null; then</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                        cd </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name}-biz</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    fi</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    docker build -t </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{image_name} .</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    docker push </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{image_name}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    cd </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">WORKSPACE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  done</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                configFileProvider([configFile(fileId:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">k8s_auth</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> targetLocation:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin.kubeconfig</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)]){</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                    sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    # 添加镜像拉取认证</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    kubectl create secret docker-registry </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image_pull_secret</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --docker-username=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">username</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --docker-password=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">password</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --docker-server=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -n </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Namespace</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --kubeconfig admin.kubeconfig |true</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    # 添加私有chart仓库</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                    helm repo add  --username </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">username</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --password </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">password</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> myrepo http://</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/chartrepo/</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">operation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">              }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        stage(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&#39;Helm部署到K8S&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          steps</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              common_args=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-n</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Namespace</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --kubeconfig</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> admin.kubeconfig</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              </span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              for service in  </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">(echo </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> |sed &#39;s/,/ /g&#39;); do</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                service_name=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service%:*}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                service_port=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service#*:}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                image=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">operation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                tag=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">BUILD_NUMBER</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                helm_args=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image.repository=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{image}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image.tag=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{tag}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replicaCount=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">replicaCount</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> imagePullSecrets[0].name=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">image_pull_secret</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service.targetPort=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_port}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> myrepo/</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                # 判断是否为新部署</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                if helm history </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{common_args} &amp;&gt;/dev/null;then</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  action=upgrade</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                else</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  action=install</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                # 针对服务启用ingress</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                if [ </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name} == </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gateway-service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ]; then</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  helm </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{action} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{helm_args} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  --set ingress.enabled=true </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  --set ingress.host=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gateway_domain_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">                   \$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{common_args}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                elif [ </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{service_name} == </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">portal-service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ]; then</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  helm </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{action} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{helm_args} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  --set ingress.enabled=true </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  --set ingress.host=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">portal_domain_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">                   \$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{common_args}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                else</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  helm </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{action} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{helm_args} </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{common_args}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                fi</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              done</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              # 查看Pod状态</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              sleep 10</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              kubectl get pods </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{common_args}</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">              &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终效果图：</p><p><img src="/images/2C996A5FE9374972B3F1C34D6C139C33clipboard.png" alt=""></p><h3 id="流水线脚本与源代码一起版本管理" tabindex="-1"><a class="header-anchor" href="#流水线脚本与源代码一起版本管理"><span>流水线脚本与源代码一起版本管理</span></a></h3><p>Jenkinsfile文件建议与源代码一起版本管理，实现流水线即 代码（Pipeline as Code）。</p><p>这样做的好处：</p><ul><li><p>自动为所有分支创建流水线脚本</p></li><li><p>方便流水线代码复查、追踪、迭代</p></li><li><p>可被项目成员查看和编辑</p></li></ul><p><img src="/images/1CB58EC278494B95B4CF18806EC80C36clipboard.png" alt=""></p><p><img src="/images/857EAC3742DE4C009FB7B571FB68F768clipboard.png" alt=""></p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><p>使用Jenkins的插件</p><ul><li><p>Git &amp; gitParameter</p></li><li><p>Kubernetes</p></li><li><p>Pipeline</p></li><li><p>Config File Provider</p></li><li><p>Extended Choice Parameter</p></li></ul><p>CI/CD环境特点</p><ul><li><p>Slave弹性伸缩</p></li><li><p>基于镜像隔离构建环境</p></li><li><p>流水线发布，易维护</p></li></ul><p>Jenkins参数化构建可帮助你完成更复杂环境CI/CD</p><p>回滚思路：</p><p>1.使用kubectl rollout ,将资源名称和命名空间等参数化传入</p><p>2.每次发布记录发布的镜像版本写到一个历史文件中，Extended choice Parameter从历史文件中作为选择项</p></div></main><footer class="vp-doc-footer" data-v-e798167f data-v-f2100d82><!--[--><!--]--><div class="edit-info" data-v-f2100d82><div class="edit-link" data-v-f2100d82><a class="vp-link no-icon link edit-link-button" href="https://github.com/liuzhemax/docs/edit/main/docs/notes/k8s/upgrade/8.基于jenkins构建微服务发布平台.md" target="_blank" rel="noreferrer" data-v-f2100d82 data-v-442a52aa><!--[--><span class="vpi-square-pen edit-link-icon" aria-label="edit icon" data-v-f2100d82></span> 编辑此页<!--]--><!----></a></div><!----></div><!----><nav class="prev-next" data-v-f2100d82><div class="pager" data-v-f2100d82><a class="vp-link no-icon link pager-link prev" href="/notes/k8s/0orp8ikp/" data-v-f2100d82 data-v-442a52aa><!--[--><span class="desc" data-v-f2100d82>上一页</span><span class="title" data-v-f2100d82>微服务容器化迁移</span><!--]--><!----></a></div><div class="pager" data-v-f2100d82><a class="vp-link no-icon link pager-link next" href="/notes/k8s/hed98b6p/" data-v-f2100d82 data-v-442a52aa><!--[--><span class="desc" data-v-f2100d82>下一页</span><span class="title" data-v-f2100d82>微服务治理istio初探上</span><!--]--><!----></a></div></nav></footer><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;" data-v-e798167f><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-0b7e05b4 data-v-9d19ba45><span class="percent" data-v-9d19ba45>0%</span><span class="show icon vpi-back-to-top" data-v-9d19ba45></span><svg aria-hidden="true" data-v-9d19ba45><circle cx="50%" cy="50%" style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-9d19ba45></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-0b7e05b4 data-v-368f94aa><div class="container" data-v-368f94aa><!----><p class="copyright" data-v-368f94aa>Copyright © 2024 阿哲 www.azhe.asia</p></div></footer><!--[--><!--]--><!--]--></div><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-D5peQ_E2.js" defer></script></body></html>