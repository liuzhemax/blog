import{_ as i,c as a,e as n,o as l}from"./app-D5peQ_E2.js";const e={};function p(h,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="configmap" tabindex="-1"><a class="header-anchor" href="#configmap"><span>ConfigMap</span></a></h2><p>创建ConfigMap后，数据实际会存储在K8s中Etcd，然后通过创建Pod时引用该数据。</p><p>应用场景：应用程序配置</p><p>Pod使用configmap数据有两种方式：</p><ul><li><p>变量注入</p></li><li><p>数据卷挂载</p></li></ul><p>两种数据类型：</p><ul><li><p>键值</p></li><li><p>多行数据</p></li></ul><p>#解释</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Pod</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  #pod的名字</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo-pod</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  containers:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      image:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> alpine</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      #用进程夯筑容器不让它退出</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      command</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">sleep</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">3600</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      env:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 定义环境变量</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 请注意这里和 ConfigMap中的键名是不一样的（自定义键的名字）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ABC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            configMapKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">              # 这个值来自 ConfigMa(comfigmap的名字)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">              # 需要取值的键          </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> abc</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                       </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CDE</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            configMapKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cde</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      #引用下面数据卷的名字</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        #挂载到容器中哪个目录下（一般是指你的应用程序配置文件存放目录）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        mountPath:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/config</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        readOnly:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  volumes:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 你可以在 Pod 级别设置卷，然后将其挂载到 Pod 内的容器中</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">     #数据卷的名字</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      configMap:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 提供你想要挂载的 ConfigMap 的名字</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 来自 ConfigMap 的一组键，将被创建为文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        items:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> key:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">redis.properties</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          path:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">redis.properties</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   #挂载到/config目录下的文件名</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vim configmap.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">data:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  abc:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">123</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  cde:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">456</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  redis.properties:</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    port:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    host:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 192.168.0.11</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vim configmap-demo-pod.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Pod</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo-pod</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  containers:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      image:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      env:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ABC</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            configMapKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> abc</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CDE</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            configMapKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cde</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        mountPath:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/config</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        readOnly:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  volumes:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      configMap:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        items:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> key:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">redis.properties</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          path:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">redis.properties</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证查看</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap.yaml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo-pod.yaml</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmaps</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap-demo-pod</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bash</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   #进入pod中测试是否注入变量和挂载</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#echo $ABC</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#echo $CDE</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#ls /config/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考链接：https://kubernetes.io/zh/docs/concepts/configuration/configmap/</p><h2 id="secret" tabindex="-1"><a class="header-anchor" href="#secret"><span>Secret</span></a></h2><p>与ConfigMap类似，区别在于Secret主要存储敏感数据，所有的数据要经过base64编码。</p><p>应用场景：凭据</p><p>kubectl create secret 支持三种数据类型：</p><ul><li><p>docker-registry（kubernetes.io/dockerconfigjson）：存储镜像仓库认证信息</p></li><li><p>generic（Opaque）：存储密码、密钥等</p></li><li><p>tls（kubernetes.io/tls）：存储TLS证书</p></li></ul><p>Pod使用Secret数据与ConfigMap方式一样。</p><p>第一步：将用户名密码进行编码</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@k8s-node1 </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">~</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># echo -n </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">base64</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">YWRtaW4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@k8s-node1 </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">~</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># echo -n </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">123.com</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">base64</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">MTIzLmNvbQ</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">=</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二步：将编码后值放到Secret</p><p>vim secret.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Secret</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db-user-pass</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Opaque</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">data:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  username:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> YWRtaW4=</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  password:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MTIzLmNvbQ==</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vim secret-demo-pod.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Pod</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> secret-demo-pod</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  containers:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    image:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    env:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> USER</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        secretKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db-user-pass</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> username</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PASS</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        secretKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db-user-pass</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> password</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      mountPath:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/config</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      readOnly:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  volumes:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    secret:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      secretName:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db-user-pass</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      items:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> username</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-username</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> password</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-password</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证查看</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> secret.yaml</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> secret-demo-pod.yaml</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> secrets</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> secret-demo-pod</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bash</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">     #进入pod中测试是否注入变量和挂载</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#echo $USER</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#echo $PASS </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#ls /config/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考链接：https://kubernetes.io/zh/docs/concepts/configuration/secret/</p><h2 id="应用程序如何动态更新配置" tabindex="-1"><a class="header-anchor" href="#应用程序如何动态更新配置"><span>应用程序如何动态更新配置</span></a></h2><p>应用程序动态更新配置方案：</p><ul><li><p>当ConfigMap发生变更时，应用程序自动感知动态加载（需要程序自身支持）</p></li><li><p>触发滚动更新，即重启服务</p></li></ul>`,35)]))}const t=i(e,[["render",p],["__file","index.html.vue"]]),d=JSON.parse(`{"path":"/notes/k8s/6aa06sf3/","title":"管理应用程序配置","lang":"zh-CN","frontmatter":{"title":"管理应用程序配置","createTime":"2024/09/29 10:25:34","permalink":"/notes/k8s/6aa06sf3/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"ConfigMap","slug":"configmap","link":"#configmap","children":[]},{"level":2,"title":"Secret","slug":"secret","link":"#secret","children":[]},{"level":2,"title":"应用程序如何动态更新配置","slug":"应用程序如何动态更新配置","link":"#应用程序如何动态更新配置","children":[]}],"readingTime":{"minutes":2.56,"words":769},"filePathRelative":"notes/k8s/introduction/10.管理应用程序配置.md"}`);export{t as comp,d as data};
