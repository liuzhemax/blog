import{_ as s,c as a,e,o as l}from"./app-D5peQ_E2.js";const t="/images/4B16166E7B5D4A9C8EF473CEF39CBAFDclipboard.png",n="/images/C29CFDD8671144E4B028504B2E4966CEclipboard.png",p="/images/34F3225902F843979C4F1E091D8D84ABclipboard.png",h="/images/3F033BCA807D4B148FEBD1030E2FA455clipboard.png",k="/images/3432DCE395E34C519D680A715D39AA2Dclipboard.png",r="/images/E0D362E4B99243DB809D6E9151AB8E8Aclipboard.png",d="/images/85AAA642A7A041AF94483F9570F5528Bclipboard.png",c="/images/969A593798B846F5957B37EFB3D3260Dclipboard.png",o="/images/39B39E61B5E448E78E446992BBA91D02clipboard.png",g="/images/EB6991F8CF47469283BDA4DE19031C16clipboard.png",A={};function y(m,i){return l(),a("div",null,i[0]||(i[0]=[e('<h2 id="service-mesh" tabindex="-1"><a class="header-anchor" href="#service-mesh"><span>Service Mesh</span></a></h2><p>Service Mesh 的中文译为 “服务网格” ，是一个用于处理服务 和服务之间通信的基础设施层，它负责为构建复杂的云原生应用 传递可靠的网络请求，并为服务通信实现了微服务所需的基本组 件功能，例如服务发现、负载均衡、监控、流量管理、访问控制 等。在实践中，服务网格通常实现为一组和应用程序部署在一起 的轻量级的网络代理，但对应用程序来说是透明的。</p><p>右图，绿色方块为应用服务，蓝色方块为 Sidecar Proxy，应用 服务之间通过 Sidecar Proxy 进行通信，整个服务通信形成图中 的蓝色网络连线，图中所有蓝色部分就形成一个网络，这个就是 服务网格名字的由来。</p><p><img src="'+t+'" alt=""></p><h2 id="service-mesh特点" tabindex="-1"><a class="header-anchor" href="#service-mesh特点"><span>Service Mesh特点</span></a></h2><p>Service Mesh有以下特点：</p><ul><li><p>治理能力独立（Sidecar）</p></li><li><p>应用程序无感知</p></li><li><p>服务通信的基础设施层</p></li><li><p>解耦应用程序的重试/超时、监控、追踪和服务发现</p></li></ul><p><img src="'+n+'" alt=""></p><h2 id="istio概述" tabindex="-1"><a class="header-anchor" href="#istio概述"><span>Istio概述</span></a></h2><p>Isito是Service Mesh的产品化落地，是目前最受欢迎的服务网格，功能丰富、成熟度高。</p><p>Linkerd是世界上第一个服务网格类的产品。</p><ul><li><p>连接（Connect）</p></li><li><p>流量管理</p></li><li><p>负载均衡</p></li><li><p>灰度发布</p></li><li><p>安全（Secure）</p></li><li><p>认证 - 鉴权</p></li><li><p>控制（Control）</p></li><li><p>限流</p></li><li><p>ACL</p></li><li><p>观察（Observe）</p></li><li><p>监控</p></li><li><p>调用链</p></li></ul><p><img src="'+p+'" alt=""></p><p><img src="'+h+'" alt=""></p><h2 id="istio版本变化" tabindex="-1"><a class="header-anchor" href="#istio版本变化"><span>Istio版本变化</span></a></h2><p>在Istio1.5版本发生了一个重大变革，彻底推翻原有控制平面的架构，将有原有多个组件整合为单体结构 “istiod”，同时废弃了Mixer 组件，如果你正在使用之前版本，必须了解这些变化。</p><p><img src="'+k+`" alt=""></p><h2 id="istio架构与组件" tabindex="-1"><a class="header-anchor" href="#istio架构与组件"><span>Istio架构与组件</span></a></h2><p>Istio服务网格在逻辑上分为数据平面和控制平面。</p><ul><li>控制平面：使用全新的部署模式：istiod，这个组件负责处理Sidecar注入、证书分发、配置管理等功能，替 代 原有组件，降低复杂度，提高易用性。</li></ul><p>Pilot：策略配置组件，为Proxy提供服务发现、智能路由、错误处理等。</p><p>Citadel：安全组件，提供证书生成下发、加密通信、访问控制。</p><p>Galley：配置管理、验证、分发。</p><ul><li>数据平面：由一组Proxy组成，这些Proxy负责所有微服务网络通信，实现高效转发和策略。使用envoy实现， envoy是一个基于C++实现的L4/L7 Proxy转发器，是Istio在数据平面唯一的组件。</li></ul><h2 id="istio基本概念" tabindex="-1"><a class="header-anchor" href="#istio基本概念"><span>Istio基本概念</span></a></h2><p>Istio 有 4 个配置资源，落地所有流量管理需求：</p><ul><li><p>VirtualService（虚拟服务）：实现服务请求路由规则的功能。</p></li><li><p>DestinationRule（目标规则）：实现目标服务的负载均衡、服务发现、故障处理和故障注入的功能。</p></li><li><p>Gateway（网关）：让服务网格内的服务，可以被全世界看到。</p></li><li><p>ServiceEntry（服务入口） ：允许管理网格外的服务的流量。</p></li></ul><h2 id="部署istio" tabindex="-1"><a class="header-anchor" href="#部署istio"><span>部署Istio</span></a></h2><p>官方文档：https://preliminary.istio.io/latest/zh/docs/setup/getting-started</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -L</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://istio.io/downloadIstio</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tar</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zxvf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> istio-1.8.2-linux.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> istio-1.8.2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mv</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bin/istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/bin</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> profile</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> list</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">或者istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> profile=default</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#查看具体的profile开启了哪些组件可用如下命令</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> profile</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dump</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [default</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">demo</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">minimal</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">remote</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">empty</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">preview]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pods</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> istio-system</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> svc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> istio-system</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#卸载：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> manifest</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> generate</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sidercar注入" tabindex="-1"><a class="header-anchor" href="#sidercar注入"><span>Sidercar注入</span></a></h2><p>部署httpbin Web示例：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> istio-1.8.2/samples/httpbin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>手动注入</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &lt;(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> kube-inject </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> httpbin-nodeport.yaml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">或者</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">istioctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> kube-inject</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> httpbin-nodeport.yaml</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自动注入（给命名空间打指定标签，启用自动注入）</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> label</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> namespace</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> istio-injection=enabled</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ns</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --show-labels</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> httpbin-gateway.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IngressGateway NodePort访问地址：http://192.168.0.11:32615/</p><p><img src="`+r+'" alt=""></p><p><img src="'+d+'" alt=""></p><h2 id="istio与k8s集成流程" tabindex="-1"><a class="header-anchor" href="#istio与k8s集成流程"><span>Istio与K8s集成流程</span></a></h2><p><img src="'+c+'" alt=""></p><h2 id="服务网关-gateway" tabindex="-1"><a class="header-anchor" href="#服务网关-gateway"><span>服务网关：Gateway</span></a></h2><p><img src="'+o+'" alt=""></p><p>Gateway为网格内服务提供负载均衡器，提供以下功能：</p><ul><li><p>L4-L7的负载均衡</p></li><li><p>对外的mTLS</p></li></ul><p>Gateway根据流入流出方向分为：</p><ul><li><p>IngressGateway：接收外部访问，并将流量转发到网格内的服务。</p></li><li><p>EgressGateway：网格内服务访问外部应用。</p></li></ul><p>在实际部署中，K8s集群一般部署在内网，为了将暴露到互联 网，会在前面加一层负载均衡器，用于流量入口，将用户访问 的域名传递给IngressGateway，IngressGateway再转发到不 同应用。</p><p><img src="'+g+'" alt=""></p><p>学习：</p><p>https://www.it610.com/article/1292898160674414592.htm</p><p>https://blog.csdn.net/lswzw/article/details/104745617/</p>',53)]))}const v=s(A,[["render",y],["__file","index.html.vue"]]),B=JSON.parse(`{"path":"/notes/k8s/hed98b6p/","title":"微服务治理istio初探上","lang":"zh-CN","frontmatter":{"title":"微服务治理istio初探上","createTime":"2024/09/29 12:17:15","permalink":"/notes/k8s/hed98b6p/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"Service Mesh","slug":"service-mesh","link":"#service-mesh","children":[]},{"level":2,"title":"Service Mesh特点","slug":"service-mesh特点","link":"#service-mesh特点","children":[]},{"level":2,"title":"Istio概述","slug":"istio概述","link":"#istio概述","children":[]},{"level":2,"title":"Istio版本变化","slug":"istio版本变化","link":"#istio版本变化","children":[]},{"level":2,"title":"Istio架构与组件","slug":"istio架构与组件","link":"#istio架构与组件","children":[]},{"level":2,"title":"Istio基本概念","slug":"istio基本概念","link":"#istio基本概念","children":[]},{"level":2,"title":"部署Istio","slug":"部署istio","link":"#部署istio","children":[]},{"level":2,"title":"Sidercar注入","slug":"sidercar注入","link":"#sidercar注入","children":[]},{"level":2,"title":"Istio与K8s集成流程","slug":"istio与k8s集成流程","link":"#istio与k8s集成流程","children":[]},{"level":2,"title":"服务网关：Gateway","slug":"服务网关-gateway","link":"#服务网关-gateway","children":[]}],"readingTime":{"minutes":3.67,"words":1102},"filePathRelative":"notes/k8s/upgrade/9.微服务治理istio初探上.md"}`);export{v as comp,B as data};
