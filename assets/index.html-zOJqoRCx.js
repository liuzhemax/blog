import{_ as i,c as a,e as n,o as l}from"./app-D5peQ_E2.js";const e="/images/7327EAB29F8F4C73A7B379DF9D660DDEclipboard.png",p="/images/0749CCA49C9444DA9A410901C5F3C4B8clipboard.png",h="/images/1506058D05CA4D20B52B277B065B60ABclipboard.png",k="/images/06ED566FF1074B42A72AF5B779FE1C3Aclipboard.png",t="/images/335EB09272114DD3BF1BC4A424A77A7Dclipboard.png",d="/images/64A3856A336D42DFA7B90B914E97D60Dclipboard.png",r="/images/CE03F82EDAB4453B93B6E5C1B62E92E4clipboard.png",c="/images/FF2962E0EEF647ECBE7499D744E04A67clipboard.png",A={};function g(v,s){return l(),a("div",null,s[0]||(s[0]=[n('<p>部署项目前的梳理：</p><p>1.项目的代码构成，什么语言开发的</p><p>2.项目的依赖环境</p><p>3.项目的配置文件在哪里</p><p>4.项目的端口清单</p><p>5.项目有没有做数据的持久化</p><h2 id="容器交付流程" tabindex="-1"><a class="header-anchor" href="#容器交付流程"><span>容器交付流程</span></a></h2><p><img src="'+e+'" alt=""></p><h2 id="在k8s平台部署项目流程" tabindex="-1"><a class="header-anchor" href="#在k8s平台部署项目流程"><span>在K8s平台部署项目流程</span></a></h2><p><img src="'+p+'" alt=""></p><h2 id="在k8s平台部署java网站项目" tabindex="-1"><a class="header-anchor" href="#在k8s平台部署java网站项目"><span>在K8s平台部署Java网站项目</span></a></h2><p>阿里云maven源地址： https://maven.aliyun.com/mvn/guide</p><p>第一步：制作镜像</p><p><img src="'+h+`" alt=""></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-1.8.0-openjdk</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> maven</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/lizhenliang/tomcat-java-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mvn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clean</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> package</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -Dmaven.test.skip=true</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 代码编译构建</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">unzip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> target/</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.war</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> target/ROOT</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 解压构建文件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">FROM</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lizhenliang/tomcat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">LABEL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> maintainer</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> www.ctnrs.com</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">RUN</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -rf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/tomcat/webapps/</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">COPY</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> target/ROOT</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/tomcat/webapps/ROOT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image:tag</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> push</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">镜像仓库地</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">址</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">项目</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">名</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/image:tag</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image:tag</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用镜像仓库（私有仓库、公共仓库）：</p><p>1、配置可信任（如果仓库是HTTPS访问不用配置）</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># vi /etc/docker/daemon.json</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    insecure-registries</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;: [&quot;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">192.168.0.13</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、将镜像仓库认证凭据保存在K8s Secret中</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> secret</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker-registry</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> registry-auth</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --docker-username=admin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --docker-password=Harbor12345</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --docker-server=192.168.0.13</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3、在yaml中使用这个认证凭据</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      imagePullSecrets:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> registry-auth</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+k+'" alt=""></p><p>配置认证的的原因是部署的harbor是私有仓库，k8s的每个节点每次去拉取镜像都必须登录harbor仓库，比较麻烦，通过在yaml配置文件指定docker登录认证凭据，这样docker每次部署的时候就会自动去拉取镜像了。</p><p>第二步：使用控制器部署镜像</p><p><img src="'+t+'" alt=""></p><p><img src="'+d+`" alt=""></p><p>注意：在pod中挂载configmap配置文件时，如果指定容器内挂载的目录不是空目录，那么会覆盖原来目录下的内容。</p><p>部署configmap</p><p>vim configmap.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">data:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    application.yml:</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        server:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          port:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        spring:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          datasource:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            url:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jdbc:mysql://java-demo-db:3306/k8s?characterEncoding=utf-8</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            username:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> azhe</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            password:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 123456</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            driver-class-name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          freemarker:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            allow-request-override:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            cache:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            check-template-location:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            charset:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> UTF-8</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            content-type:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> text/html</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> charset</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">utf-8</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            expose-request-attributes:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            expose-session-attributes:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            expose-spring-macro-helpers:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            suffix:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .ftl</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            template-loader-path:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> classpath:/templates/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>部署deployment</p><p>vim deployment.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apps/v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Deployment</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> web</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  replicas:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      app:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  template:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      labels:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        app:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      imagePullSecrets:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> registry-auth</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      containers:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.13/demo/java-demo:v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        resources:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          requests:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            cpu:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.5</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            memory:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 500Mi</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          limits:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            cpu:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            memory:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1Gi</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        livenessProbe:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          httpGet:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            port:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          initialDelaySeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 40</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          periodSeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        readinessProbe:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          httpGet:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            port:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          initialDelaySeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 40</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          periodSeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          mountPath:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/usr/local/tomcat/webapps/ROOT/WEB-INF/classes/application.yml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          subPath:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">application.yml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      volumes:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        configMap:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-config</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          items:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> key:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">application.yml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            path:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">application.yml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configmap.yaml</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deployment.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>第三步：对外暴露应用</p><p><img src="`+r+`" alt=""></p><p>部署service</p><p>vim service.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Service</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    app:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  ports:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> protocol:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TCP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      port:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 80</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      targetPort:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>部署ingress（首先部署nginx-ingress-controller，监听端口是80和443)</p><p>vim ingress.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Ingress</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  rules:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java.ctnrs.com</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    http:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      paths:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          pathType:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Prefix</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          backend:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            service:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              port:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                number:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>部署mysql数据库（1.部署NFS实现自动创建PV插件 2.导入表到k8s数据库）</p><p><a href="/attachments/AD05901F881F482EAC2E9A51FE4E8E13nfs-client.zip">nfs-client.zip</a></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#安装nfs安装包（每个k8s节点都要安装）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs-utils</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#创建nfs共享目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /nfs/kubernetes</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#修改nfs配置文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/exports</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">/nfs/kubernetes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">rw,no_root_squash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#启动nfs并加入开机自启</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#部署NFS实现自动创建PV插件：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/kubernetes-incubator/external-storage</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nfs-client/deploy</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rbac.yaml</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 授权访问apiserver </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deployment.yaml</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 部署插件，需修改里面NFS服务器地址与共享目录 </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> class.yaml</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 创建存储类</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sc</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 查看存储类</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#导入表到k8s数据库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pod</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tables_ly_tomcat.sql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db-6c775c4d4b-7xfgc:/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db-6c775c4d4b-7xfgc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bash</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> databses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">use</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> k8s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">source</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /tables_ly_tomcat.sql</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vim mysql.yaml</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Secret</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  namespace:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Opaque</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">data:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  mysql-root-password:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MTIzNDU2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  mysql-password:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MTIzNDU2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apps/v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Deployment</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  namespace:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      operation:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> www</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      app:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  template:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      labels:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        operation:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> www</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        app:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      containers:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        image:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:5.7.30</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        resources:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          requests:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            cpu:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 500m</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            memory:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 512Mi</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          limits:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            cpu:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 500m</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            memory:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 512Mi</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        env:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            secretKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-root-password</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            secretKeyRef:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              key:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-password</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_USER</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          value:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">azhe</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_DATABASE</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          value:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">k8s</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        ports:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          containerPort:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3306</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        livenessProbe:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">          exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">            command</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            -</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqladmin ping -u root -p</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">\${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          initialDelaySeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 30</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          periodSeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        readinessProbe:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">          exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">            command</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            -</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqladmin ping -u root -p</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">\${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          initialDelaySeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          periodSeconds:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          mountPath:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /var/lib/mysql</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      volumes:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        persistentVolumeClaim:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          claimName:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PersistentVolumeClaim</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  namespace:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  storageClassName:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">managed-nfs-storage</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  accessModes:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ReadWriteOnce</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  resources:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    requests:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      storage:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">8Gi</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Service</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo-db</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  namespace:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">spec:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  type</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  ports:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    port:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3306</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    targetPort:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    operation:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> www</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    app:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service.yaml</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ingress.yaml</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apply</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问java.ctnrs.com，添加用户验证数据库是否可用</p><p>第四步：增加公网负载均衡器</p><p><img src="`+c+`" alt=""></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">upstream</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java-demo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.12:80</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.13:80</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">         listen</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 81</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">         server_name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> java.ctnrs.com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">         location</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            proxy_pass</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http://java-demo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">            proxy_set_header</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Host</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $Host</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">         }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问java.ctnrs.com:81</p><p>1、为指定用户授权访问不同命名空间权限</p><p>2、使用Helm完成Java网站项目部署</p><p>注：自由发挥，实现需求即可</p>`,60)]))}const m=i(A,[["render",g],["__file","index.html.vue"]]),u=JSON.parse(`{"path":"/notes/k8s/vbm16uxm/","title":"实际项目部署案例","lang":"zh-CN","frontmatter":{"title":"实际项目部署案例","createTime":"2024/09/29 11:18:12","permalink":"/notes/k8s/vbm16uxm/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"容器交付流程","slug":"容器交付流程","link":"#容器交付流程","children":[]},{"level":2,"title":"在K8s平台部署项目流程","slug":"在k8s平台部署项目流程","link":"#在k8s平台部署项目流程","children":[]},{"level":2,"title":"在K8s平台部署Java网站项目","slug":"在k8s平台部署java网站项目","link":"#在k8s平台部署java网站项目","children":[]}],"readingTime":{"minutes":3.99,"words":1197},"filePathRelative":"notes/k8s/introduction/15.实际项目部署案例.md"}`);export{m as comp,u as data};
