import{_ as i,c as a,e,o as n}from"./app-D5peQ_E2.js";const t="/images/E3B36C187C82414586DA0A7367E1B31Bclipboard.png",l="/images/BA52A032787A42758426CAF01D8AACB1clipboard.png",p="/images/E2F18ADD59A84E83ACE7E0F825E8D7E8clipboard.png",h="/images/A812511EBAB24D9EBFFEB01CE69B1C20clipboard.png",r="/images/1D91E9CE52744E6CB827F933C91A077Eclipboard.png",d="/images/DEF412843B6C4704A5C2B3E6F57F59ADclipboard.png",k="/images/7AD845D09CCD45B5B68A0B680AD0FB26clipboard.png",c="/images/F5000B15B5194E3FAFE7B8B1A7FC5D4Bclipboard.png",o="/images/B796AEA5D2864F808470AA5EAAE0D064clipboard.png",g="/images/B6434EAC66CB4A22A08B4DCA224B85BFclipboard.png",m="/images/DE1892A5D524426EBD4CD412F7FAB733clipboard.png",A="/images/706016A1999644A19A216B4D1604543Eclipboard.png",y="/images/32FE1DECE1BB439BB3BDC9C7CB0A8B14clipboard.png",u="/images/2A22682600B84FBEBBA23CB5343C68C8clipboard.png",v="/images/70F7975C4A31404D99A6F8570F8FF650clipboard.png",D="/images/6D7AF83697AB496299CD0AB7FE0F9282clipboard.png",B={};function b(C,s){return n(),a("div",null,s[0]||(s[0]=[e('<h2 id="主流认证方式" tabindex="-1"><a class="header-anchor" href="#主流认证方式"><span>主流认证方式</span></a></h2><p>主流认证方式：</p><ul><li><p>Session</p></li><li><p>Token</p></li><li><p>JWT</p></li></ul><h3 id="主流认证方式-session认证" tabindex="-1"><a class="header-anchor" href="#主流认证方式-session认证"><span>主流认证方式：Session认证</span></a></h3><p><img src="'+t+'" alt=""></p><h3 id="主流认证方式-token认证" tabindex="-1"><a class="header-anchor" href="#主流认证方式-token认证"><span>主流认证方式：Token认证</span></a></h3><p><img src="'+l+'" alt=""></p><h3 id="主流认证方式-jwt认证" tabindex="-1"><a class="header-anchor" href="#主流认证方式-jwt认证"><span>主流认证方式：JWT认证</span></a></h3><p><img src="'+p+'" alt=""></p><h2 id="drf认证" tabindex="-1"><a class="header-anchor" href="#drf认证"><span>DRF认证</span></a></h2><h3 id="drf认证与权限" tabindex="-1"><a class="header-anchor" href="#drf认证与权限"><span>DRF认证与权限</span></a></h3><p>目前DRF可任意访问，没有任何限制，是不符合生产环境标准的，因此接下来学习认证实现访问控制。</p><p>DRF支持四种认证方式：</p><ul><li><p>BasicAuthentication：基于用户名和密码的认证，适用于测试</p></li><li><p>SessionAuthentication：基于Session的认证</p></li><li><p>TokenAuthentication：基于Token的认证</p></li><li><p>RemoteUserAuthentication：基于远程用户的认证</p></li></ul><p>DRF支持权限：</p><ul><li><p>IsAuthenticated：只有登录用户才能访问所有API</p></li><li><p>AllowAny：允许所有用户</p></li><li><p>IsAdminUser：仅管理员用户</p></li><li><p>IsAuthenticatedOrReadOnly：登录的用户可以读写API，未登录用户只读</p></li></ul><h3 id="drf认证-session认证" tabindex="-1"><a class="header-anchor" href="#drf认证-session认证"><span>DRF认证：Session认证</span></a></h3><p><img src="'+h+'" alt=""></p><p><img src="'+r+'" alt=""></p><h3 id="drf认证-token认证" tabindex="-1"><a class="header-anchor" href="#drf认证-token认证"><span>DRF认证：Token认证</span></a></h3><p><img src="'+d+'" alt=""></p><p><img src="'+k+'" alt=""></p><p>默认的obtain_auth_token视图返回的数据是比较简单的，只有token一项，如果想返回更多的信息， 例如用户名，可以重写ObtainAuthToken类的方法实现：</p><p><img src="'+c+'" alt=""></p><h2 id="限流" tabindex="-1"><a class="header-anchor" href="#限流"><span>限流</span></a></h2><p>可以对接口访问的频率进行限制，以减轻服务器压力。</p><p>应用场景：投票、购买数量等</p><p><img src="'+o+`" alt=""></p><h2 id="过滤" tabindex="-1"><a class="header-anchor" href="#过滤"><span>过滤</span></a></h2><p>对于列表数据可能需要根据字段进行过滤，我们可以通过添加django-fitlter扩展来增强支持。</p><p>文档：https 😕/www.django-rest-framework.org/api-guide/filtering/</p><p>安装：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">pip install django</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">filter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>添加APP：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">INSTALLED_APPS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> ...</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">django_filters</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加DRF配置：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">REST_FRAMEWORK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 过滤</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">DEFAULT_FILTER_BACKENDS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">django_filters.rest_framework.DjangoFilterBackend</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在视图中指定过滤的字段：</p><p><img src="`+g+'" alt=""></p><p>测试：http://127.0.0.1:8001/myapp_api/api/user?name=阿哲</p><h2 id="搜索和排序" tabindex="-1"><a class="header-anchor" href="#搜索和排序"><span>搜索和排序</span></a></h2><p>DRF提供过滤器帮助我们快速对字段进行搜索和排序。</p><p><img src="'+m+`" alt=""></p><p>搜索测试：http://127.0.0.1:8001/myapp_api/api/user?search=阿哲</p><p>排序测试：http://127.0.0.1:8001/myapp_api/api/user?ordering=id</p><p>注：默认是正序排列，字段前面加横杠（例如-id）表示倒序排列</p><h2 id="分页" tabindex="-1"><a class="header-anchor" href="#分页"><span>分页</span></a></h2><p>分页是数据表格必备的功能，可以在前端实现，也可以在后端实现，为了避免响 应数据过大，造成前端压力，一般在后端实现。</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">REST_FRAMEWORK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ={</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    #分页</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">    &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">DEFAULT_PAGINATION_CLASS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">rest_framework.pagination.PageNumberPagination</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">    &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">PAGE_SIZE</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 每页数目</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+A+'" alt=""></p><p>默认分页器灵活度不高，例如不能动态传递每页条数，可以通过重写 PageNumberPagination类属性改变默认配置。</p><p>myapp_api/pagination.py</p><p><img src="'+y+'" alt=""></p><p>DRF配置指定模块路径：</p><p><img src="'+u+'" alt=""></p><p>测试：http://127.0.0.1:8001/myapp_api/api/user?page_num=2&amp;page_size=3</p><p><img src="'+v+`" alt=""></p><h2 id="自动生成接口文档" tabindex="-1"><a class="header-anchor" href="#自动生成接口文档"><span>自动生成接口文档</span></a></h2><p>由于项目开发经验欠缺或着急上线，需求不断改动，项目设计阶段定义的接口已经面目全非，这给 前端开发人员参考带来一定困难，如何改善这个问题呢？</p><p>Swagger来了，它是一个应用广泛的REST API文档自动生成工具，生成的文档可供前端人员查看。</p><p>文档参考：https 😕/django-rest-swagger.readthedocs.io/en/latest/</p><p>安装：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">pip install django</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rest</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">swagger</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>添加APP：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">INSTALLED_APPS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">     ...</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">     &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">rest_framework_swagger</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>DRF配置：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">REST_FRAMEWORK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # API接口文档</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">    &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">DEFAULT_SCHEMA_CLASS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">rest_framework.schemas.coreapi.AutoSchema</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>URL路由：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> rest_framework_swagger</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">views </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> get_swagger_view</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">schema_view </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> get_swagger_view</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">title</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">接口文档</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">urlpatterns </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">+=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    re_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^docs/$</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> schema_view</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+D+'" alt=""></p>',70)]))}const _=i(B,[["render",b],["__file","4.drf常用功能.html.vue"]]),f=JSON.parse(`{"path":"/notes/django/upgrade/4.drf%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD.html","title":"drf常用功能","lang":"zh-CN","frontmatter":{"title":"drf常用功能","date":"2024-05-04T08:45:32.000Z","type":"categories","categories":"DRF","tag":"DRF","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"主流认证方式","slug":"主流认证方式","link":"#主流认证方式","children":[{"level":3,"title":"主流认证方式：Session认证","slug":"主流认证方式-session认证","link":"#主流认证方式-session认证","children":[]},{"level":3,"title":"主流认证方式：Token认证","slug":"主流认证方式-token认证","link":"#主流认证方式-token认证","children":[]},{"level":3,"title":"主流认证方式：JWT认证","slug":"主流认证方式-jwt认证","link":"#主流认证方式-jwt认证","children":[]}]},{"level":2,"title":"DRF认证","slug":"drf认证","link":"#drf认证","children":[{"level":3,"title":"DRF认证与权限","slug":"drf认证与权限","link":"#drf认证与权限","children":[]},{"level":3,"title":"DRF认证：Session认证","slug":"drf认证-session认证","link":"#drf认证-session认证","children":[]},{"level":3,"title":"DRF认证：Token认证","slug":"drf认证-token认证","link":"#drf认证-token认证","children":[]}]},{"level":2,"title":"限流","slug":"限流","link":"#限流","children":[]},{"level":2,"title":"过滤","slug":"过滤","link":"#过滤","children":[]},{"level":2,"title":"搜索和排序","slug":"搜索和排序","link":"#搜索和排序","children":[]},{"level":2,"title":"分页","slug":"分页","link":"#分页","children":[]},{"level":2,"title":"自动生成接口文档","slug":"自动生成接口文档","link":"#自动生成接口文档","children":[]}],"readingTime":{"minutes":2.54,"words":761},"filePathRelative":"notes/django/upgrade/4.drf常用功能.md"}`);export{_ as comp,f as data};
